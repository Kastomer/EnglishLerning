document.querySelectorAll(".openTests").forEach(tests => {
    let id = tests.dataset.id;
    tests.querySelectorAll(".test-card-person").forEach(testCard =>{

        testCard.querySelector(".test-card-person__btn").onclick = () =>{

            const popup = testCard.querySelector(".popup-fade_tests");
            const popupClose = testCard.querySelector(".popup-close");
            $(popup).fadeIn();
            window.scrollTo(0, 0);

            $(popupClose).click(function () {
                $(popup).fadeOut();
                return false;
            });
        }

        testCard.querySelector('.popup-controll__content-answer').onclick = () => {
            let idTest = testCard.querySelector('.popup-controll__content-answer').dataset.id;
            let estimation, fail= [];
            let rus = [];
            testCard.querySelectorAll('.popup-controll__inputs-row').forEach( inputs => {
                rus.push(inputs.querySelector('.popup-controll__input_answer').value);
            });
            // console.log(rus);
            fetch('/student-lk/comtest',{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8'
                },
                body: JSON.stringify({
                    id_test: idTest,
                    prov: rus,
                    id: id
                })
            }).then(response => response.json())
            .then(res => {
                estimation = res.estimation;
                fail = res.fal;
                testCard.querySelector('.popup-controll__inputs-wrap_estimation').innerHTML  = 'Ваша оценка: '+estimation;

                testCard.querySelectorAll('.popup-controll__inputs-row').forEach( inputs => {
                    let id = inputs.querySelector('.popup-controll-tests__radio-answer').dataset.row;
                    if (res.fal.includes(Number(id))) {
                        inputs.querySelector(`.popup-controll-tests__radio-answer_none`).classList.toggle('popup-controll-tests__radio-answer_false');
                        inputs.querySelector(`.popup-controll-tests__radio-answer_none`).classList.toggle('popup-controll-tests__radio-answer_none');
                    }else {
                        inputs.querySelector(`.popup-controll-tests__radio-answer_none`).classList.toggle('popup-controll-tests__radio-answer_true');
                        inputs.querySelector(`.popup-controll-tests__radio-answer_none`).classList.toggle('popup-controll-tests__radio-answer_none');
                    }
                    testCard.querySelector('.popup-controll__content-answer').innerHTML = 'Закрыть';
                    testCard.querySelector('.popup-controll__content-answer').onclick = () =>{
                        location.reload();
                    }
                });
            })

        }
    })
})